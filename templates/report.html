<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analiz Raporu - Malware Analysis Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f8fafe 0%, #e8f4fd 100%);
            min-height: 100vh;
        }
        .card {
            border: 1px solid rgba(116, 185, 255, 0.2);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.1);
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }
        .card:hover {
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.2);
            transform: translateY(-2px);
        }
        .card-header {
            background: linear-gradient(135deg, #74b9ff 0%, #3498db 100%);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            border-bottom: none;
            font-weight: 600;
        }
        .progress {
            background-color: rgba(116, 185, 255, 0.2);
            border-radius: 15px;
            height: 25px;
        }
        .progress-bar {
            border-radius: 15px;
            transition: width 0.8s ease;
            box-shadow: 0 2px 8px rgba(116, 185, 255, 0.3);
        }
        .risk-critical { 
            background: linear-gradient(135deg, #e74c3c, #c0392b); 
            color: white;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-weight: bold;
        }
        .risk-high { 
            background: linear-gradient(135deg, #f39c12, #e67e22); 
            color: white;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-weight: bold;
        }
        .risk-medium { 
            background: linear-gradient(135deg, #3498db, #2980b9); 
            color: white;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-weight: bold;
        }
        .risk-low { 
            background: linear-gradient(135deg, #27ae60, #2ecc71); 
            color: white;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-weight: bold;
        }
        .btn-custom-blue {
            background: linear-gradient(135deg, #74b9ff 0%, #3498db 100%);
            border: none;
            color: white;
            border-radius: 25px;
            padding: 0.6rem 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }
        .btn-custom-blue:hover {
            transform: translateY(-2px);
            color: white;
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.4);
        }
        .ioc-item {
            background: linear-gradient(135deg, #f8fbff 0%, #e3f2fd 100%);
            border: 1px solid rgba(116, 185, 255, 0.3);
            border-radius: 8px;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            word-break: break-all;
        }
        .finding-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fbff 100%);
            border-left: 4px solid #74b9ff;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        .finding-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.2);
        }
        .mitre-item {
            background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%);
            border: 1px solid rgba(231, 76, 60, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .section-entropy {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .entropy-critical {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        .entropy-medium {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        .entropy-low {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shield-virus me-2"></i>
                Malware Analysis Platform
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Ana Sayfa</a>
                <a class="nav-link" href="/upload">Yeni Analiz</a>
                <a class="nav-link active" href="#" style="background: rgba(255,255,255,0.2); border-radius: 20px; padding: 0.5rem 1rem;">Rapor</a>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <div class="card" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white;">
                    <div class="card-body p-4">
                        <h1 class="fw-bold mb-3">
                            <i class="fas fa-file-alt me-3"></i>
                            Malware Analiz Raporu
                        </h1>
                        <p class="mb-2 fs-5">Dosya ID: <span class="badge bg-light text-dark">{{ report.file_id }}</span></p>
                        <p class="mb-0">
                            <i class="fas fa-calendar me-2"></i>
                            Analiz Tarihi: {{ report.analysis_date[:19] | replace('T', ' ') }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Assessment -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Risk Değerlendirmesi
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        {% if report.ai_analysis and report.ai_analysis.rapor_ozeti %}
                            {% set risk_level = report.ai_analysis.rapor_ozeti.tehlike_seviyesi %}
                            {% set risk_score = report.ai_analysis.rapor_ozeti.risk_skoru %}
                            
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <span class="badge fs-5 px-4 py-2 me-3
                                            {% if risk_level == 'KRİTİK' %}risk-critical
                                            {% elif risk_level == 'YÜKSEK' %}risk-high
                                            {% elif risk_level == 'ORTA' %}risk-medium
                                            {% else %}risk-low{% endif %}">
                                            <i class="fas fa-exclamation-triangle me-2"></i>{{ risk_level }} RİSK
                                        </span>
                                        <span class="fs-3 fw-bold text-primary">{{ risk_score }}/100</span>
                                    </div>
                                    <div class="alert alert-info border-0 p-3" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                                        <h6 class="fw-bold text-primary">Kısa Değerlendirme:</h6>
                                        {{ report.ai_analysis.rapor_ozeti.kisa_degerlendirme }}
                                    </div>
                                </div>
                                <div class="col-md-4 text-center">
                                    <h6 class="text-muted mb-3">Risk Seviyesi</h6>
                                    <div class="progress mb-3" style="height: 30px;">
                                        <div class="progress-bar fw-bold text-center
                                            {% if risk_score >= 70 %}bg-danger
                                            {% elif risk_score >= 40 %}bg-warning
                                            {% else %}bg-success{% endif %}"
                                            style="width: {{ risk_score if risk_score > 0 else 10 }}%; line-height: 30px;">
                                            {{ risk_score }}%
                                        </div>
                                    </div>
                                    {% if risk_score >= 70 %}
                                        <span class="badge bg-danger fs-6">YÜKSEK TEHLİKE</span>
                                    {% elif risk_score >= 40 %}
                                        <span class="badge bg-warning fs-6">ORTA TEHLİKE</span>
                                    {% else %}
                                        <span class="badge bg-success fs-6">DÜŞÜK TEHLİKE</span>
                                    {% endif %}
                                </div>
                            </div>
                        {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Risk değerlendirme bilgisi bulunamadı.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- File Information -->
        <div class="row mb-4">
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            Dosya Bilgileri
                        </h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tr>
                                <td class="fw-bold text-primary">Dosya Tipi:</td>
                                <td><span class="badge bg-primary">{{ report.ai_analysis.teknik_analiz.dosya_kimligi.tip if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.dosya_kimligi and report.ai_analysis.teknik_analiz.dosya_kimligi.tip else (report.file_info.file_type if report.file_info.file_type else 'Bilinmiyor') }}</span></td>
                            </tr>
                            <tr>
                                <td class="fw-bold text-primary">Hedef OS:</td>
                                <td>{{ report.ai_analysis.teknik_analiz.dosya_kimligi.hedef_isletim_sistemi if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.dosya_kimligi and report.ai_analysis.teknik_analiz.dosya_kimligi.hedef_isletim_sistemi else (report.file_info.target_os if report.file_info.target_os else 'Bilinmiyor') }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold text-primary">Mimari:</td>
                                <td>{{ report.ai_analysis.teknik_analiz.dosya_kimligi.mimari if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.dosya_kimligi and report.ai_analysis.teknik_analiz.dosya_kimligi.mimari else 'Bilinmiyor' }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold text-primary">Boyut:</td>
                                <td>{{ report.ai_analysis.rapor_ozeti.dosya_boyutu if report.ai_analysis and report.ai_analysis.rapor_ozeti and report.ai_analysis.rapor_ozeti.dosya_boyutu else 'Bilinmiyor' }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold text-primary">Timestamp:</td>
                                <td>{{ report.ai_analysis.teknik_analiz.dosya_kimligi.timestamp if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.dosya_kimligi and report.ai_analysis.teknik_analiz.dosya_kimligi.timestamp else (report.file_info.timestamp if report.file_info.timestamp else 'Bulunamadı') }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold text-primary">Compiler:</td>
                                <td>{{ report.ai_analysis.teknik_analiz.dosya_kimligi.compiler if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.dosya_kimligi and report.ai_analysis.teknik_analiz.dosya_kimligi.compiler else 'Bilinmiyor' }}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold text-primary">Entry Point:</td>
                                <td><code>{{ report.ai_analysis.teknik_analiz.dosya_kimligi.entry_point if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.dosya_kimligi and report.ai_analysis.teknik_analiz.dosya_kimligi.entry_point else 'Bulunamadı' }}</code></td>
                            </tr>
                            {% if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.dosya_kimligi and report.ai_analysis.teknik_analiz.dosya_kimligi.pdb_adi %}
                            <tr>
                                <td class="fw-bold text-primary">PDB:</td>
                                <td><code>{{ report.ai_analysis.teknik_analiz.dosya_kimligi.pdb_adi }}</code></td>
                            </tr>
                            {% endif %}
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-fingerprint me-2"></i>
                            Hash Değerleri
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong class="text-primary">MD5:</strong>
                            <div class="ioc-item">{{ report.ai_analysis.rapor_ozeti.md5 if report.ai_analysis and report.ai_analysis.rapor_ozeti and report.ai_analysis.rapor_ozeti.md5 else (report.file_info.md5 if report.file_info.md5 else 'Bulunamadı') }}</div>
                        </div>
                        <div class="mb-3">
                            <strong class="text-primary">SHA256:</strong>
                            <div class="ioc-item">{{ report.ai_analysis.rapor_ozeti.sha256 if report.ai_analysis and report.ai_analysis.rapor_ozeti and report.ai_analysis.rapor_ozeti.sha256 else (report.file_info.sha256 if report.file_info.sha256 else 'Bulunamadı') }}</div>
                        </div>
                        {% if (report.ai_analysis and report.ai_analysis.rapor_ozeti and report.ai_analysis.rapor_ozeti.sha1) %}
                        <div class="mb-3">
                            <strong class="text-primary">SHA1:</strong>
                            <div class="ioc-item">{{ report.ai_analysis.rapor_ozeti.sha1 }}</div>
                        </div>
                        {% endif %}
                        {% if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.dosya_kimligi and report.ai_analysis.teknik_analiz.dosya_kimligi.imphash %}
                        <div class="mb-2">
                            <strong class="text-primary">IMPHASH:</strong>
                            <div class="ioc-item">{{ report.ai_analysis.teknik_analiz.dosya_kimligi.imphash }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- User Report -->
        {% if report.ai_analysis and report.ai_analysis.kullanici_raporu %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-user-shield me-2"></i>
                            Kullanıcı İçin Rapor
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-8">
                                <h6 class="fw-bold text-primary mb-3">Bu Dosya Ne Yapıyor?</h6>
                                <div class="alert alert-info border-0" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                                    {{ report.ai_analysis.kullanici_raporu.bu_dosya_ne_yapiyor }}
                                </div>
                            </div>
                            <div class="col-md-4 text-center">
                                <h6 class="fw-bold text-primary mb-3">Aciliyet Durumu</h6>
                                <span class="badge fs-5 px-4 py-3 
                                    {% if report.ai_analysis.kullanici_raporu.aciliyet_durumu and 'Yüksek' in report.ai_analysis.kullanici_raporu.aciliyet_durumu %}risk-high
                                    {% elif report.ai_analysis.kullanici_raporu.aciliyet_durumu and 'Orta' in report.ai_analysis.kullanici_raporu.aciliyet_durumu %}risk-medium
                                    {% else %}risk-low{% endif %}">
                                    <i class="fas fa-clock me-2"></i>
                                    {{ report.ai_analysis.kullanici_raporu.aciliyet_durumu if report.ai_analysis.kullanici_raporu.aciliyet_durumu else 'Düşük Öncelik' }}
                                </span>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="alert alert-info border-0 p-4" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                                <h6 class="fw-bold text-primary mb-3">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Genel Değerlendirme
                                </h6>
                                <p class="mb-0 fs-6">{{ report.ai_analysis.kullanici_raporu.genel_degerlendirme }}</p>
                            </div>
                            
                            {% if report.ai_analysis.kullanici_raporu.yapilmasi_gerekenler %}
                            <div class="mt-4">
                                <h6 class="fw-bold text-warning mb-3">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Yapılması Gerekenler
                                </h6>
                                <div class="row">
                                    {% for yapmak in report.ai_analysis.kullanici_raporu.yapilmasi_gerekenler %}
                                        <div class="col-md-6 mb-3">
                                            <div class="alert alert-warning border-0" style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);">
                                                <i class="fas fa-arrow-right text-warning me-2"></i>
                                                {{ yapmak }}
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Risks and Recommendations -->
        <div class="row mb-4">
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Potansiyel Riskler
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if report.ai_analysis.kullanici_raporu.potansiyel_riskler %}
                            {% for risk in report.ai_analysis.kullanici_raporu.potansiyel_riskler %}
                                <div class="alert alert-warning border-0 mb-3" style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);">
                                    <h6 class="fw-bold text-dark mb-2">
                                        <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                                        Risk {{ loop.index }}
                                    </h6>
                                    {{ risk }}
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-shield-check fa-3x text-success mb-3"></i>
                                <p class="text-muted">Belirli risk bilgisi bulunamadı.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-shield-alt me-2"></i>
                            Korunma Önerileri
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if report.ai_analysis.kullanici_raporu.oneriler %}
                            {% for oneri in report.ai_analysis.kullanici_raporu.oneriler %}
                                <div class="alert alert-success border-0 mb-3" style="background: linear-gradient(135deg, #d1edff 0%, #a8e6cf 100%);">
                                    <h6 class="fw-bold text-dark mb-2">
                                        <i class="fas fa-shield-alt text-success me-2"></i>
                                        Öneri {{ loop.index }}
                                    </h6>
                                    {{ oneri }}
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-info-circle fa-3x text-info mb-3"></i>
                                <p class="text-muted">Özel öneri bulunamadı.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Analysis -->
        {% if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.section_analizi %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-layer-group me-2"></i>
                            PE Section Analizi
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th class="text-primary">Section</th>
                                        <th class="text-primary">Boyut</th>
                                        <th class="text-primary">Entropi</th>
                                        <th class="text-primary">İzinler</th>
                                        <th class="text-primary">Değerlendirme</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for section in report.ai_analysis.teknik_analiz.section_analizi %}
                                        <tr>
                                            <td><code class="fw-bold">{{ section.section_adi }}</code></td>
                                            <td>{{ section.boyut }}</td>
                                            <td>
                                                <span class="section-entropy 
                                                    {% set entropy = section.entropi | float %}
                                                    {% if entropy > 7.0 %}entropy-critical
                                                    {% elif entropy > 4.0 %}entropy-medium
                                                    {% else %}entropy-low{% endif %}">
                                                    {{ section.entropi }}
                                                </span>
                                            </td>
                                            <td><code class="badge bg-secondary">{{ section.izinler }}</code></td>
                                            <td>
                                                {% if 'Kritik' in section.supheli_durum %}
                                                    <span class="badge bg-danger">Kritik</span>
                                                    <small class="text-danger d-block mt-1">{{ section.supheli_durum }}</small>
                                                {% elif 'Düşük' in section.supheli_durum %}
                                                    <span class="badge bg-success">Normal</span>
                                                {% else %}
                                                    <span class="badge bg-warning">Dikkat</span>
                                                    <small class="text-warning d-block mt-1">{{ section.supheli_durum }}</small>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Key Findings -->
        {% if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.anahtar_bulgular %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-search me-2"></i>
                            Önemli Bulgular
                        </h5>
                    </div>
                    <div class="card-body">
                        {% for bulgu in report.ai_analysis.teknik_analiz.anahtar_bulgular %}
                            <div class="finding-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="fw-bold text-primary mb-0">{{ bulgu.bulgu }}</h6>
                                    <span class="badge 
                                        {% if bulgu.risk_seviyesi == 'Kritik' %}bg-danger
                                        {% elif bulgu.risk_seviyesi == 'Yüksek' %}bg-warning
                                        {% elif bulgu.risk_seviyesi == 'Orta' %}bg-info
                                        {% else %}bg-success{% endif %}">
                                        {{ bulgu.risk_seviyesi }} Risk
                                    </span>
                                </div>
                                <p class="text-muted mb-2">{{ bulgu.aciklama }}</p>
                                {% if bulgu.kanit %}
                                    <div class="mt-2">
                                        <small class="text-primary fw-bold">Kanıtlar:</small>
                                        {% for kanit in bulgu.kanit %}
                                            <div class="ioc-item mt-1">{{ kanit }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- MITRE ATT&CK -->
        {% if report.ai_analysis and report.ai_analysis.teknik_analiz and report.ai_analysis.teknik_analiz.mitre_attack %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-crosshairs me-2"></i>
                            MITRE ATT&CK Teknikleri
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for teknik in report.ai_analysis.teknik_analiz.mitre_attack %}
                                <div class="col-md-6 mb-3">
                                    <div class="mitre-item">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <h6 class="fw-bold text-dark mb-0">{{ teknik.teknik_adi }}</h6>
                                            <span class="badge bg-danger">{{ teknik.teknik_id }}</span>
                                        </div>
                                        <p class="text-muted mb-2">{{ teknik.aciklama }}</p>
                                        {% if teknik.kanit %}
                                            <div class="mt-2">
                                                <small class="text-danger fw-bold">Kanıtlar:</small>
                                                {% for kanit in teknik.kanit %}
                                                    <div class="ioc-item mt-1">{{ kanit }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- VirusTotal Results -->
        {% if (report.quickscope_output and report.quickscope_output.virustotal_results and report.quickscope_output.virustotal_results.total_scans > 0) or (report.ai_analysis and report.ai_analysis.virustotal_analizi) %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-shield-virus me-2"></i>
                            VirusTotal Analiz Sonuçları
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if report.ai_analysis and report.ai_analysis.virustotal_analizi %}
                        <!-- AI'dan gelen VirusTotal analizi -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="text-center">
                                    <h3 class="mb-0 text-danger">{{ report.ai_analysis.virustotal_analizi.tespit_orani }}</h3>
                                    <p class="text-muted">Tespit Eden / Toplam Tarayıcı</p>
                                    <span class="badge fs-5 px-4 py-3 
                                        {% if 'Yüksek' in report.ai_analysis.virustotal_analizi.risk_seviyesi %}risk-high
                                        {% elif 'Orta' in report.ai_analysis.virustotal_analizi.risk_seviyesi %}risk-medium
                                        {% else %}risk-low{% endif %}">
                                        {{ report.ai_analysis.virustotal_analizi.risk_seviyesi }} Risk
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-info border-0" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                                    <h6 class="fw-bold text-primary">Genel Değerlendirme:</h6>
                                    {{ report.ai_analysis.virustotal_analizi.genel_degerlendirme }}
                                </div>
                                {% if report.ai_analysis.virustotal_analizi.ilk_tespit_tarihi %}
                                <p class="text-muted mb-0">
                                    <i class="fas fa-clock me-2"></i>
                                    İlk Tespit: {{ report.ai_analysis.virustotal_analizi.ilk_tespit_tarihi }}
                                </p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Tespit Eden Motorlar -->
                        {% if report.ai_analysis.virustotal_analizi.tespit_eden_motorlar %}
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="fw-bold text-danger mb-3">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Tespit Eden Antivirus Motorları
                                </h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Antivirus</th>
                                                <th>Tespit Edilen Malware</th>
                                                <th>Güvenilirlik</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for motor in report.ai_analysis.virustotal_analizi.tespit_eden_motorlar %}
                                            <tr>
                                                <td class="fw-bold">{{ motor.antivirus }}</td>
                                                <td><code class="text-danger">{{ motor.sonuc }}</code></td>
                                                <td>
                                                    <span class="badge 
                                                        {% if motor.guvenilirlik == 'Yüksek' %}bg-success
                                                        {% elif motor.guvenilirlik == 'Orta' %}bg-warning
                                                        {% else %}bg-secondary{% endif %}">
                                                        {{ motor.guvenilirlik }}
                                                    </span>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Malware Aileleri -->
                        {% if report.ai_analysis.virustotal_analizi.malware_aileleri %}
                        <div class="row mb-3">
                            <div class="col-12">
                                <h6 class="fw-bold text-primary mb-2">Tespit Edilen Malware Türleri:</h6>
                                {% for aile in report.ai_analysis.virustotal_analizi.malware_aileleri %}
                                    <span class="badge bg-danger me-2 mb-1">{{ aile }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% elif report.quickscope_output and report.quickscope_output.virustotal_results and report.quickscope_output.virustotal_results.total_scans > 0 %}
                        <!-- Ham QuickScope VirusTotal verileri -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="text-center">
                                    <h3 class="mb-0">
                                        <span class="text-danger">{{ report.quickscope_output.virustotal_results.positive_detections }}</span>
                                        /
                                        <span class="text-muted">{{ report.quickscope_output.virustotal_results.total_scans }}</span>
                                    </h3>
                                    <p class="text-muted">Tespit Eden / Toplam Tarayıcı</p>
                                    {% set detection_rate = (report.quickscope_output.virustotal_results.positive_detections / report.quickscope_output.virustotal_results.total_scans * 100) if report.quickscope_output.virustotal_results.total_scans > 0 else 0 %}
                                    <div class="progress mb-2" style="height: 20px;">
                                        <div class="progress-bar 
                                            {% if detection_rate > 50 %}bg-danger
                                            {% elif detection_rate > 20 %}bg-warning
                                            {% else %}bg-success{% endif %}"
                                            style="width: {{ detection_rate }}%">
                                            {{ "%.1f"|format(detection_rate) }}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    {% if report.quickscope_output.virustotal_results.scan_date %}
                                    <tr>
                                        <td class="fw-bold text-primary">Tarama Tarihi:</td>
                                        <td>{{ report.quickscope_output.virustotal_results.scan_date }}</td>
                                    </tr>
                                    {% endif %}
                                    {% if report.quickscope_output.virustotal_results.permalink %}
                                    <tr>
                                        <td class="fw-bold text-primary">VirusTotal Link:</td>
                                        <td>
                                            <a href="{{ report.quickscope_output.virustotal_results.permalink }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-external-link-alt me-1"></i>
                                                Detayları Görüntüle
                                            </a>
                                        </td>
                                    </tr>
                                    {% endif %}
                                </table>
                            </div>
                        </div>
                        
                        <!-- Scan Results Details -->
                        {% if report.quickscope_output.virustotal_results.scan_results %}
                        <div class="row">
                            <div class="col-12">
                                <h6 class="fw-bold text-primary mb-3">Detaylı Tarayıcı Sonuçları</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Antivirus Motor</th>
                                                <th>Sonuç</th>
                                                <th>Durum</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for scan in report.quickscope_output.virustotal_results.scan_results %}
                                            <tr>
                                                <td class="fw-bold">{{ scan.engine }}</td>
                                                <td>
                                                    {% if scan.result and scan.result.lower() not in ['clean', 'undetected'] %}
                                                        <code class="text-danger">{{ scan.result }}</code>
                                                    {% else %}
                                                        <span class="text-success">Temiz</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if scan.result and scan.result.lower() not in ['clean', 'undetected'] %}
                                                        <span class="badge bg-danger">Tespit Edildi</span>
                                                    {% else %}
                                                        <span class="badge bg-success">Temiz</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- IOC -->
        {% if report.ai_analysis and report.ai_analysis.ioc_listesi %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            IOC (Indicators of Compromise)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% if report.ai_analysis.ioc_listesi.dosya_hashleri %}
                            <div class="col-md-6 mb-4">
                                <h6 class="fw-bold text-danger mb-3">
                                    <i class="fas fa-fingerprint me-2"></i>Dosya Hash'leri
                                </h6>
                                {% for hash in report.ai_analysis.ioc_listesi.dosya_hashleri %}
                                    <div class="ioc-item d-flex justify-content-between align-items-center">
                                        <span>{{ hash }}</span>
                                        <button class="btn btn-sm btn-custom-blue" onclick="navigator.clipboard.writeText('{{ hash }}')" title="Kopyala">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                            
                            {% if report.ai_analysis.ioc_listesi.ip_adresleri %}
                            <div class="col-md-6 mb-4">
                                <h6 class="fw-bold text-info mb-3">
                                    <i class="fas fa-globe me-2"></i>IP Adresleri
                                </h6>
                                {% for ip in report.ai_analysis.ioc_listesi.ip_adresleri %}
                                    <div class="ioc-item">{{ ip }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}

                            {% if report.ai_analysis.ioc_listesi.dosya_yollari %}
                            <div class="col-md-6 mb-4">
                                <h6 class="fw-bold text-secondary mb-3">
                                    <i class="fas fa-folder me-2"></i>Dosya Yolları
                                </h6>
                                {% for path in report.ai_analysis.ioc_listesi.dosya_yollari %}
                                    <div class="ioc-item">{{ path }}</div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Technical Summary -->
        {% if report.quickscope_output %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-cogs me-2"></i>
                            Teknik Özet
                        </h5>
                        <button class="btn btn-custom-blue btn-sm" data-bs-toggle="collapse" data-bs-target="#technicalSummary">
                            <i class="fas fa-eye me-1"></i> Detayları Göster
                        </button>
                    </div>
                    <div id="technicalSummary" class="collapse">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <h6 class="fw-bold text-primary">YARA Eşleşmeleri:</h6>
                                    {% if report.quickscope_output.yara_matches %}
                                        {% for match in report.quickscope_output.yara_matches %}
                                            <div class="badge bg-info me-1 mb-1">{{ match.rule_name }}</div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-muted">YARA eşleşmesi bulunamadı.</p>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    <h6 class="fw-bold text-primary">Sınıf Analizi:</h6>
                                    {% if report.quickscope_output.classes_analysis %}
                                        {% for class in report.quickscope_output.classes_analysis %}
                                            <div class="small text-muted mb-1">{{ class.class_name }}</div>
                                        {% endfor %}
                                    {% else %}
                                        <p class="text-muted">Sınıf bilgisi bulunamadı.</p>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    <h6 class="fw-bold text-primary">VirusTotal Özet:</h6>
                                    {% if report.ai_analysis and report.ai_analysis.virustotal_analizi %}
                                        <div class="mb-2">
                                            <span class="badge 
                                                {% if 'Yüksek' in report.ai_analysis.virustotal_analizi.risk_seviyesi %}bg-danger
                                                {% elif 'Orta' in report.ai_analysis.virustotal_analizi.risk_seviyesi %}bg-warning
                                                {% else %}bg-success{% endif %}">
                                                {{ report.ai_analysis.virustotal_analizi.tespit_orani }} Tespit
                                            </span>
                                        </div>
                                        {% if report.ai_analysis.virustotal_analizi.malware_aileleri %}
                                            <small class="text-danger">{{ ', '.join(report.ai_analysis.virustotal_analizi.malware_aileleri) }} tespit edildi!</small>
                                        {% else %}
                                            <small class="text-success">Temiz dosya</small>
                                        {% endif %}
                                    {% endif %}
                                    {% elif report.quickscope_output.virustotal_results and report.quickscope_output.virustotal_results.total_scans > 0 %}
                                        <div class="mb-2">
                                            <span class="badge 
                                                {% if report.quickscope_output.virustotal_results.positive_detections > 5 %}bg-danger
                                                {% elif report.quickscope_output.virustotal_results.positive_detections > 0 %}bg-warning
                                                {% else %}bg-success{% endif %}">
                                                {{ report.quickscope_output.virustotal_results.positive_detections }}/{{ report.quickscope_output.virustotal_results.total_scans }} Tespit
                                            </span>
                                        </div>
                                        {% if report.quickscope_output.virustotal_results.positive_detections > 0 %}
                                            <small class="text-danger">Malware tespit edildi!</small>
                                        {% else %}
                                            <small class="text-success">Temiz dosya</small>
                                        {% endif %}
                                    {% else %}
                                        <p class="text-muted">VirusTotal analizi yapılmadı.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Raw Output -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between">
                        <h5 class="mb-0">
                            <i class="fas fa-terminal me-2"></i>
                            Ham Qu1cksc0pe Çıktısı
                        </h5>
                        <button class="btn btn-custom-blue btn-sm" data-bs-toggle="collapse" data-bs-target="#rawOutput">
                            <i class="fas fa-code me-1"></i> Göster/Gizle
                        </button>
                    </div>
                    <div id="rawOutput" class="collapse">
                        <div class="card-body">
                            <pre class="bg-dark text-light p-3" style="border-radius: 8px; max-height: 400px; overflow-y: auto; font-size: 0.8rem;"><code>{{ report.quickscope_output | tojson(indent=2) if report.quickscope_output else 'Ham çıktı bulunamadı' }}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="row mb-5">
            <div class="col-12 text-center">
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    <a href="/upload" class="btn btn-custom-blue btn-lg">
                        <i class="fas fa-plus me-2"></i>
                        Yeni Analiz
                    </a>
                    <a href="/download_report/{{ report.file_id }}" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-download me-2"></i>
                        Raporu İndir
                    </a>
                    <a href="/" class="btn btn-outline-secondary btn-lg">
                        <i class="fas fa-home me-2"></i>
                        Ana Sayfa
                    </a>
                    <button class="btn btn-outline-info btn-lg" onclick="window.print()">
                        <i class="fas fa-print me-2"></i>
                        Yazdır
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Clipboard functionality
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                // Başarı mesajı gösterebiliriz
                console.log('Panoya kopyalandı: ' + text);
            }, function(err) {
                console.error('Kopyalama hatası: ', err);
            });
        }

        // Auto-expand important sections if high risk
        document.addEventListener('DOMContentLoaded', function() {
            const riskScore = {{ report.ai_analysis.rapor_ozeti.risk_skoru if report.ai_analysis and report.ai_analysis.rapor_ozeti and report.ai_analysis.rapor_ozeti.risk_skoru else 0 }};
            
            if (riskScore >= 70) {
                // Yüksek risk durumunda önemli bölümleri otomatik aç
                const technicalSummary = document.getElementById('technicalSummary');
                if (technicalSummary) {
                    technicalSummary.classList.add('show');
                }
            }
        });
    </script>
</body>
</html>
{% endif %}
